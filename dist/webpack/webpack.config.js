'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _config=require('../config');var _config2=_interopRequireDefault(_config);var _webpack=require('webpack');var _webpack2=_interopRequireDefault(_webpack);var _path=require('path');var _path2=_interopRequireDefault(_path);var _os=require('os');var _os2=_interopRequireDefault(_os);var _extractTextWebpackPlugin=require('extract-text-webpack-plugin');var _extractTextWebpackPlugin2=_interopRequireDefault(_extractTextWebpackPlugin);var _happypack=require('happypack');var _happypack2=_interopRequireDefault(_happypack);var _copyWebpackPlugin=require('copy-webpack-plugin');var _copyWebpackPlugin2=_interopRequireDefault(_copyWebpackPlugin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var __DEBUG__=_config2.default.__DEBUG__;var __DEV__=_config2.default.__DEV__;var output=_config2.default.output;var bundleEntry=_config2.default.bundleEntry;var libEntry=_config2.default.libEntry;var copyWebpackPluginItems=_config2.default.copyWebpackPluginItems;var noParseDeps=_config2.default.noParseDeps;var happyThreadPool=_happypack2.default.ThreadPool({size:_os2.default.cpus().length});var assetsSrcDirs=_config2.default.assetsSrcDirs;var libsDir=_config2.default.libsDir;var nodeModulesDir=_config2.default.nodeModulesDir;var isNeedCompress=!__DEBUG__&&!__DEV__;var entries=libEntry;var webpackPlugins=[];var bundleEntryKeys=Object.keys(bundleEntry);bundleEntryKeys.forEach(function(key){Object.assign(entries,bundleEntry[key]);webpackPlugins.push(new _webpack2.default.optimize.CommonsChunkPlugin({name:key,filename:'[name].js',chunks:Object.keys(bundleEntry[key]),minChunks:2}));});if(!__DEV__&&copyWebpackPluginItems.length>0){webpackPlugins.push(new _copyWebpackPlugin2.default(copyWebpackPluginItems));}var config={entry:entries,output:Object.assign(output,{filename:'[name].js'}),resolve:{modules:assetsSrcDirs,alias:{libs:libsDir,nodeModulesDir:nodeModulesDir},extensions:['*','.js','.jsx']},module:{noParse:[],rules:[{test:/\.js[x]?$/,loader:'happypack/loader',include:assetsSrcDirs},{test:/\.css$/,use:_extractTextWebpackPlugin2.default.extract({fallback:'style-loader',use:[{loader:'css-loader',options:{minimize:isNeedCompress?true:false}}]})},{test:/\.less$/,use:_extractTextWebpackPlugin2.default.extract({fallback:'style-loader',use:[{loader:'css-loader',options:{minimize:isNeedCompress?true:false}},{loader:'less-loader'}]})},{test:/\.(png|jpe?g|gif)$/,loader:'file-loader?name=img/[name].[ext]'},{test:/\.(woff|woff2|eot|ttf|svg)(\?v=\d+\.\d+\.\d+)?$/,loader:'file-loader?name=fonts/[name].[ext]'}]},plugins:[new _happypack2.default({threadPool:happyThreadPool,loaders:['babel-loader']}),new _extractTextWebpackPlugin2.default('[name].css',{allChunks:true}),new _webpack2.default.DefinePlugin({__DEBUG__:__DEBUG__,__DEV__:__DEV__})].concat(webpackPlugins)};noParseDeps.forEach(function(dep){var depPath=_path2.default.resolve(nodeModulesDir,dep);config.resolve.alias[dep.split(_path2.default.sep)[0].replace('.','-')]=depPath;config.module.noParse.push(depPath);});config.module.rules.push({test:new RegExp('('+noParseDeps.join('|')+')$'),loader:'imports-loader?define=>false&module=>false&exports=>false&this=>window'});if(isNeedCompress){config.plugins.push(new _webpack2.default.optimize.UglifyJsPlugin({compress:{warnings:false,screw_ie8:true,sequences:true,dead_code:true,drop_debugger:true,comparisons:true,conditionals:true,evaluate:true,booleans:true,loops:true,unused:true,hoist_funs:true,if_return:true,join_vars:true,cascade:true,drop_console:true},output:{comments:false}}));}exports.default=config;